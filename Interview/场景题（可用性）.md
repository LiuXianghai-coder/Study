# 场景题（可用性）

## 概念

系统可用性、系统可靠性、系统稳定性概念

- 系统可用性（Availability）：故障时间少，能保证一定比率（$99\% - 99.9\%$）的请求都能正常访问
- 系统可靠性（Reliability）：故障次数少，频率低，在较长时间内能保持无故障地运行
- 系统稳定性（Stability）：在可用性和可靠性的基础上，要求系统性能稳定

## 提高可用性的策略

### 减少故障次数

减少故障次数策略包括限流、防刷、超时设置、系统巡检和故障复盘

- 限流

  保护系统不被超出其处理能力的请求冲垮，通过拒绝请求的方式，保证系统的可用性

  阈值设置：设置阈值在峰值的 $50\% - 70\%$

  通过多级布控对不同的接口采取不同的阈值设置

- 防刷

  通过限制同一时间内单一用户对特定接口的访问次数，以拒绝请求的方式，保证系统的可用性

  一般在 WAF、代理服务层面进行防刷处理

- 超时设置

  对于一些依赖的接口做的超时设置，避免接口不可用

- 系统巡检

  系统上线后或业务高风险之前进行，目的是为了提前发现系统中可能潜在的一些问题

  巡检内容主要包括：服务器的硬件指标、系统 QPS、TPS 等、是否存在慢 SQL

- 故障复盘

### 降低故障时长

故障时长 = 故障发现时长 + 故障定位时长 + 故障解决时长

- 监控告警

  旨在降低 “故障发现时长” 和 “故障定位时长”

  监控：基础监控、服务监控和业务监控

  告警：告警需要分级、告警需要控制范围、告警需要控制数量（限制发送频率）

- 上线规范

  提供相应的回滚方案，降低故障解决时长

- 无脑预案

  确定紧急预案，出现故障时按照紧急预案进行处理，降低故障定位时长和故障解决时长

- 故障演练

  旨在模拟生产环境中可能出现的各种故障，测试系统或应用在面对故障时的反应和响应能力，针对 “故障定位” 和 “故障解决”

  故障演练的目的有两个：

  - 验证 “无脑预案”
  - 把 “无脑预案” 中的步骤熟练化

### 缩小故障范围（简化链路）

- 熔断

  当下游服务出现异常时，切断对下游服务的请求

  避免由于一个服务的局部小规模故障，导致整个系统瘫痪

- 降级

  当系统出现高负载或异常时，通过牺牲部分非核心功能的方式，保证系统核心功能的可用性

- 链路拆解

  识别并拆分出核心级别的服务，使其与其它非核心级别的服务在资源上完全隔离，保证核心功能的可用性

- 切 MVP 版本

  MVP（Minimal Visible Product）最小可行版本

  上述三种方案都失效的情况下，切换到 MVP 版本以提供基本的业务功能

# 场景题（微服务拆分）

## 拆分方案

- 基于业务领域
- 基于变化频率
- 基于重要等级
- 基于并发度

## 拆分粒度

三个火枪手原则：即一个微服务拆分的粒度，最好可以容纳三个工程师同时进行开发

## 拆分标准

- 单一职责原则
- 服务自治原则
- 可观察性原则
- 可复用性原则

## 数据库

建议为每个单独的服务设置对应的数据库

系统可用性、架构贯彻性、研发效率